\documentclass[../probability-notes.tex]{subfiles}
\begin{document}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \chapter{Iterated Expectation and Variance}
    The law of iterated expectation tells the following about expectation and variance
    \begin{align*}
        E[E[X|Y]] &= E[X] \\
        Var(X) &= E[Var(X|Y)] + Var(E[X|Y])\\
    \end{align*}

    Proof for Iterated Expectation
    \begin{align*}
        P(X) &= \sum_{y} P(X|Y) P(Y) \\
        \Rightarrow E[X] &= \sum_{x} xP(X) = \sum_{x} \sum_{y} xP(X|Y)P(Y) \\
            &= \sum_{y} P(Y) \sum_{x} xP(X|Y) = \sum_{y} P(Y) E[X|Y] \\
        \text{or, } E[X] &= E[E[X|Y]] \quad \text{($E[X|Y]$ is a function of $Y$ and not $X$)}
    \end{align*}
    
    Proof for Variance
    \begin{align*}
        Var(X) &= E[X^{2}] - E[X]^{2} \\
        Var(X|Y) &= E[(X-\overline{X})^{2}|Y] = E[X^{2}|Y] - E[X|Y]^{2} \tag*{1}\\
        Var[E(X|Y)] &= E[E(X|Y)^{2}] - E[E[X|Y]]^{2}\\
                    &= E[E[(X|Y)]^{2}] - E[X]^{2} \tag*{2}\\
        E[Var(X|Y)] &= E[E[X^{2}|Y]] - E[E[X|Y]^{2}] \tag*{from 1}\\
                    &= E[X^{2}] - E[E[X|Y]^{2}] \tag*{3}\\
        E[Var(X|Y)] + Var(E[X|Y]) &= E[X^{2}] - E[X]^{2} \tag*{adding 2 and 3}\\
                                    &= Var(X)
    \end{align*}
\end{document}